import{b as P}from"./paths.CQM_VkiC.js";import{g as C}from"./entry.C_ofhlVa.js";const E=window.location.protocol,j=window.location.host,f=`${E}//${j}`,A=`${f}/authly/api`,S=`${f}/system/api`;class m extends Error{constructor(e,o,t){const r=e.status||e.status===0?e.status:"",i=e.statusText||"",n=`${r} ${i}`.trim(),a=n?`status code ${n}`:"an unknown error";super(`Request failed with ${a}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=e,this.request=o,this.options=t}}class w extends Error{constructor(e){super("Request timed out"),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=e}}const u=s=>s!==null&&typeof s=="object",l=(...s)=>{for(const e of s)if((!u(e)||Array.isArray(e))&&e!==void 0)throw new TypeError("The `options` argument must be an object");return d({},...s)},_=(s={},e={})=>{const o=new globalThis.Headers(s),t=e instanceof globalThis.Headers,r=new globalThis.Headers(e);for(const[i,n]of r.entries())t&&n==="undefined"||n===void 0?o.delete(i):o.set(i,n);return o},d=(...s)=>{let e={},o={};for(const t of s)if(Array.isArray(t))Array.isArray(e)||(e=[]),e=[...e,...t];else if(u(t)){for(let[r,i]of Object.entries(t))u(i)&&r in e&&(i=d(e[r],i)),e={...e,[r]:i};u(t.headers)&&(o=_(o,t.headers),e.headers=o)}return e},U=(()=>{let s=!1,e=!1;const o=typeof globalThis.ReadableStream=="function",t=typeof globalThis.Request=="function";return o&&t&&(e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type")),s&&!e})(),k=typeof globalThis.AbortController=="function",O=typeof globalThis.ReadableStream=="function",D=typeof globalThis.FormData=="function",g=["get","post","put","patch","head","delete"],I={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},b=2147483647,T=Symbol("stop"),L={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},N={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},$=s=>g.includes(s)?s.toUpperCase():s,B=["get","put","head","delete","options","trace"],H=[408,413,429,500,502,503,504],R=[413,429,503],q={limit:2,methods:B,statusCodes:H,afterStatusCodes:R,maxRetryAfter:Number.POSITIVE_INFINITY,backoffLimit:Number.POSITIVE_INFINITY,delay:s=>.3*2**(s-1)*1e3},J=(s={})=>{if(typeof s=="number")return{...q,limit:s};if(s.methods&&!Array.isArray(s.methods))throw new Error("retry.methods must be an array");if(s.statusCodes&&!Array.isArray(s.statusCodes))throw new Error("retry.statusCodes must be an array");return{...q,...s,afterStatusCodes:R}};async function F(s,e,o,t){return new Promise((r,i)=>{const n=setTimeout(()=>{o&&o.abort(),i(new w(s))},t.timeout);t.fetch(s,e).then(r).catch(i).then(()=>{clearTimeout(n)})})}async function M(s,{signal:e}){return new Promise((o,t)=>{e&&(e.throwIfAborted(),e.addEventListener("abort",r,{once:!0}));function r(){clearTimeout(i),t(e.reason)}const i=setTimeout(()=>{e==null||e.removeEventListener("abort",r),o()},s)})}const W=(s,e)=>{const o={};for(const t in e)!(t in N)&&!(t in L)&&!(t in s)&&(o[t]=e[t]);return o};class c{static create(e,o){const t=new c(e,o),r=async()=>{if(typeof t._options.timeout=="number"&&t._options.timeout>b)throw new RangeError(`The \`timeout\` option cannot be greater than ${b}`);await Promise.resolve();let n=await t._fetch();for(const a of t._options.hooks.afterResponse){const h=await a(t.request,t._options,t._decorateResponse(n.clone()));h instanceof globalThis.Response&&(n=h)}if(t._decorateResponse(n),!n.ok&&t._options.throwHttpErrors){let a=new m(n,t.request,t._options);for(const h of t._options.hooks.beforeError)a=await h(a);throw a}if(t._options.onDownloadProgress){if(typeof t._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!O)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return t._stream(n.clone(),t._options.onDownloadProgress)}return n},i=t._options.retry.methods.includes(t.request.method.toLowerCase())?t._retry(r):r();for(const[n,a]of Object.entries(I))i[n]=async()=>{t.request.headers.set("accept",t.request.headers.get("accept")||a);const h=(await i).clone();if(n==="json"){if(h.status===204||(await h.clone().arrayBuffer()).byteLength===0)return"";if(o.parseJson)return o.parseJson(await h.text())}return h[n]()};return i}constructor(e,o={}){var r,i;Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=e;const t=this._input instanceof Request&&"credentials"in Request.prototype?this._input.credentials:void 0;if(this._options={...t&&{credentials:t},...o,headers:_(this._input.headers,o.headers),hooks:d({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},o.hooks),method:$(o.method??this._input.method),prefixUrl:String(o.prefixUrl||""),retry:J(o.retry),throwHttpErrors:o.throwHttpErrors!==!1,timeout:o.timeout??1e4,fetch:o.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(k){if(this.abortController=new globalThis.AbortController,this._options.signal){const n=this._options.signal;this._options.signal.addEventListener("abort",()=>{this.abortController.abort(n.reason)})}this._options.signal=this.abortController.signal}if(U&&(this._options.duplex="half"),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const n="?"+(typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString()),a=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,n);(D&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(a,{...this.request}),this._options)}this._options.json!==void 0&&(this._options.body=((i=(r=this._options).stringifyJson)==null?void 0:i.call(r,this._options.json))??JSON.stringify(this._options.json),this.request.headers.set("content-type",this._options.headers.get("content-type")??"application/json"),this.request=new globalThis.Request(this.request,{body:this._options.body}))}_calculateRetryDelay(e){if(this._retryCount++,this._retryCount<=this._options.retry.limit&&!(e instanceof w)){if(e instanceof m){if(!this._options.retry.statusCodes.includes(e.response.status))return 0;const t=e.response.headers.get("Retry-After");if(t&&this._options.retry.afterStatusCodes.includes(e.response.status)){let r=Number(t);return Number.isNaN(r)?r=Date.parse(t)-Date.now():r*=1e3,this._options.retry.maxRetryAfter!==void 0&&r>this._options.retry.maxRetryAfter?0:r}if(e.response.status===413)return 0}const o=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,o)}return 0}_decorateResponse(e){return this._options.parseJson&&(e.json=async()=>this._options.parseJson(await e.text())),e}async _retry(e){try{return await e()}catch(o){const t=Math.min(this._calculateRetryDelay(o),b);if(t!==0&&this._retryCount>0){await M(t,{signal:this._options.signal});for(const r of this._options.hooks.beforeRetry)if(await r({request:this.request,options:this._options,error:o,retryCount:this._retryCount})===T)return;return this._retry(e)}throw o}}async _fetch(){for(const o of this._options.hooks.beforeRequest){const t=await o(this.request,this._options);if(t instanceof Request){this.request=t;break}if(t instanceof Response)return t}const e=W(this.request,this._options);return this._options.timeout===!1?this._options.fetch(this.request.clone(),e):F(this.request.clone(),e,this.abortController,this._options)}_stream(e,o){const t=Number(e.headers.get("content-length"))||0;let r=0;return e.status===204?(o&&o({percent:1,totalBytes:t,transferredBytes:r},new Uint8Array),new globalThis.Response(null,{status:e.status,statusText:e.statusText,headers:e.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(i){const n=e.body.getReader();o&&o({percent:0,transferredBytes:0,totalBytes:t},new Uint8Array);async function a(){const{done:h,value:p}=await n.read();if(h){i.close();return}if(o){r+=p.byteLength;const x=t===0?0:r/t;o({percent:x,transferredBytes:r,totalBytes:t},p)}i.enqueue(p),await a()}await a()}}),{status:e.status,statusText:e.statusText,headers:e.headers})}}/*! MIT License Â© Sindre Sorhus */const y=s=>{const e=(o,t)=>c.create(o,l(s,t));for(const o of g)e[o]=(t,r)=>c.create(t,l(s,r,{method:o}));return e.create=o=>y(l(o)),e.extend=o=>y(l(s,o)),e.stop=T,e},v=y(),V=v.extend({throwHttpErrors:!1,hooks:{afterResponse:[async(s,e,o)=>{if(o.status===401){let t=`${P}/login`;!window.location.href.includes(t)&&!window.location.href.includes("?next")&&(t+=`?next=${encodeURIComponent(window.location.href)}`),C(t)}}]}});export{A,f as B,S,V as a,v as k};
